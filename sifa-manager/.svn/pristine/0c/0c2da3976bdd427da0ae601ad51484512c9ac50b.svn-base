package com.rowell.sifa.service.statistics;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;
import java.util.Timer;
import java.util.TimerTask;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.rowell.sifa.mapper.statistics.CulpritStatusTjMapper;
import com.rowell.sifa.pojo.statistics.CulpritStatusTj;
import com.rowell.sifa.pojo.sys.SysAccount;
import com.rowell.sifa.pojo.sys.SysGroup;
import com.rowell.sifa.service.base.CrudService;
import com.rowell.sifa.service.sys.SysGroupService;
/**
 * 
    * @ClassName: CulpritTjService  
    * @Description: 社区矫正对象情况统计表
    * @author DELL  
    * @date 2017年4月13日  
    *
 */
@Service
@Transactional(readOnly = true)
public class CulpritStatusTjService extends CrudService<CulpritStatusTjMapper,CulpritStatusTj>  {
	@Autowired
	private SysGroupService sysGroupService;
	@Autowired
	private CulpritStatusTjMapper culpritStatusTjMapper;
	
	public List<CulpritStatusTj>findChildTj(CulpritStatusTj culpritStatusTj){
		//找出所有子部门
		String groupId=culpritStatusTj.getGroupId();
		SysGroup sysGroup=new SysGroup();
		sysGroup.setParentId(groupId);
		List<SysGroup> childGroups=sysGroupService.findAll(sysGroup);
		List<CulpritStatusTj> childList=new ArrayList<CulpritStatusTj>();
		CulpritStatusTj c=new CulpritStatusTj();
		for(SysGroup childGroup:childGroups){
			c=culpritStatusTjMapper.selectByGroupId(childGroup.getId(),culpritStatusTj.getReportDate());
			childList.add(c);
		}
		return childList;
		
	}
	
	//每月1日生成司法所统计表记录
	public void timerInsert(){
		Calendar calendar = Calendar.getInstance();
		calendar.add(calendar.MONTH, -1);//上个月份
        Date reportDate =calendar.getTime();
		List<SysGroup>list=sysGroupService.findAll(new SysGroup());
		CulpritStatusTj culpritStatusTj=new CulpritStatusTj();
		for(SysGroup sysGroup:list){
			String groupId=sysGroup.getId();
			culpritStatusTj.setGroupId(groupId);
			culpritStatusTj.setDicState("91802");//未上报
			culpritStatusTj.setDicWdmcId("91701");//文档名称
			culpritStatusTj.setCurrentSysUser(new SysAccount());
			//统计年月
			culpritStatusTj.setReportDate(reportDate);
			//本月在册人数
			int byzcrs=culpritStatusTjMapper.findByzcrs(groupId);
			culpritStatusTj.setByzcrs(byzcrs);
			//上月在册人数
			int syzcrs=0;
			if(culpritStatusTjMapper.selectAll(culpritStatusTj).size()!=0){
				//System.out.println(culpritStatusTjMapper.findSyzcrs(groupId));
				syzcrs=Integer.parseInt(culpritStatusTjMapper.findSyzcrs(groupId));
			}
			culpritStatusTj.setSyzcrs(syzcrs);
			/**
			 * 本月减少
			 */
			//本月增加
			/*int byzj=culpritStatusTjMapper.findChange_byzj(groupId);*/
			int byzj=byzcrs-syzcrs;
			culpritStatusTj.setChange_byzj(byzj);
			//期满解除矫正
			int qmjcjz=culpritStatusTjMapper.findChange_qmjcjz(groupId);
			culpritStatusTj.setChange_qmjcjz(qmjcjz);
			//收监执行
			int sjzx=culpritStatusTjMapper.findChange_sjzx(groupId);
			culpritStatusTj.setChange_sjzx(sjzx);
			//死亡
			int sw=culpritStatusTjMapper.findChange_sw(groupId);
			culpritStatusTj.setChange_sw(sw);
			//其他原因
			int qtyy=syzcrs+byzj-byzcrs-qmjcjz-sjzx-sw;
			culpritStatusTj.setChange_qtyy(qtyy);
			/**
			 * 类别
			 */
			//管制
			culpritStatusTj.setClass_gz(culpritStatusTjMapper.findClass_lb(groupId,"20001"));
			//缓刑
			culpritStatusTj.setClass_hx(culpritStatusTjMapper.findClass_lb(groupId,"20002"));
			//假释
			culpritStatusTj.setClass_js(culpritStatusTjMapper.findClass_lb(groupId,"20003"));
			//暂予监外执行
			culpritStatusTj.setClass_zyjwzx(culpritStatusTjMapper.findClass_lb(groupId,"20004"));
			//剥夺政治权利
			culpritStatusTj.setClass_bdzzql(culpritStatusTjMapper.findClass_lb(groupId,"20005"));
			
			
			/**
			 * 犯罪类型
			 */
			//危害国家安全
			culpritStatusTj.setType_whgjaqz(culpritStatusTjMapper.findType_fzlb(groupId,"26001"));
			//危害公共安全
			culpritStatusTj.setType_whggaqz(culpritStatusTjMapper.findType_fzlb(groupId,"26002"));
			//破坏社会主义市场经济秩序
			culpritStatusTj.setType_phshzyz(culpritStatusTjMapper.findType_fzlb(groupId,"26003"));
			//侵犯公民人身权利
			culpritStatusTj.setType_qfgmrsqlz(culpritStatusTjMapper.findType_fzlb(groupId,"26004"));
			//侵犯财产
			culpritStatusTj.setType_qfccz(culpritStatusTjMapper.findType_fzlb(groupId,"26005"));
			//妨害社会管理秩序
			culpritStatusTj.setType_fhshglzxz(culpritStatusTjMapper.findType_fzlb(groupId,"26006"));
			//贪污贿赂
			culpritStatusTj.setType_twhlz(culpritStatusTjMapper.findType_fzlb(groupId,"26007"));
			//渎职
			culpritStatusTj.setType_dzz(culpritStatusTjMapper.findType_fzlb(groupId,"26008"));
			//其他
			culpritStatusTj.setType_other(culpritStatusTjMapper.findType_fzlb(groupId,"26009"));
			
			/**
			 * 户籍
			 */
			//城镇户口
			culpritStatusTj.setReg_city(culpritStatusTjMapper.findType_hk(groupId, "12001"));
			//农村户口
			culpritStatusTj.setReg_village(culpritStatusTjMapper.findType_hk(groupId, "12002"));
			//其他户口
			culpritStatusTj.setReg_other(culpritStatusTjMapper.findType_hkqt(groupId));
			
			/**
			 * 性别
			 */
			//男
			culpritStatusTj.setSex_male(culpritStatusTjMapper.findSex(groupId, "10001"));
			//女
			culpritStatusTj.setSex_female(culpritStatusTjMapper.findSex(groupId, "10002"));
			/**
			 * 名族
			 */
			//汉族
			culpritStatusTj.setNation_han(culpritStatusTjMapper.findNation(groupId, "104001"));
			//少数名族
			culpritStatusTj.setNation_few(culpritStatusTjMapper.findNation_few(groupId));
			
			/**
			 * 文化程度
			 */
			//大专及以上
			culpritStatusTj.setQualification_junior(culpritStatusTjMapper.findQualification_junior(groupId));
			//高中
			culpritStatusTj.setQualification_senior(culpritStatusTjMapper.findQualification(groupId, "19002"));
			//初中
			culpritStatusTj.setQualification_middle(culpritStatusTjMapper.findQualification(groupId, "19001"));
			//小学及以下
			culpritStatusTj.setQualification_primary(culpritStatusTjMapper.findQualification_primary(groupId));
			
			/**
			 * 就业情况
			 */
			//无业
			culpritStatusTj.setWork_nojob(culpritStatusTjMapper.findWork(groupId, "142003"));
			//已就业
			culpritStatusTj.setWork_on(culpritStatusTjMapper.findWork(groupId, "142002"));
			//在校就读
			culpritStatusTj.setWork_study(culpritStatusTjMapper.findWork(groupId, "142001"));
			
			/**
			 * 奖惩情况
			 */
			// 受治安处罚
			culpritStatusTj.setPraise_szacf(culpritStatusTjMapper.findPraise_szacf(groupId));
			//裁定减刑
			culpritStatusTj.setPraise_cdjx(culpritStatusTjMapper.findPraise_cdjx(groupId));
			//社区矫正机构奖励
			culpritStatusTj.setPraise_sqjl(culpritStatusTjMapper.findPraise_sqjl(groupId));
			//社区矫正机构处处罚
			//1.口头警告
			int ktjg=culpritStatusTjMapper.findPraise_ktjg(groupId);
			//2.警告
			int jg=culpritStatusTjMapper.findPraise_jg(groupId);
			//3.提请撤销缓刑
			int tqcxhx=culpritStatusTjMapper.findPraise_tqcxhx(groupId);
			//4.提请撤销假释
			int tqcxjs=culpritStatusTjMapper.findPraise_tqcxjs(groupId);
			//5.提请撤销监外执行
			int tqcxjwzx=culpritStatusTjMapper.findPraise_tqcxjwzx(groupId);
			
			culpritStatusTj.setPraise_sqcf(ktjg+jg+tqcxhx+tqcxjs+tqcxjwzx);
			/**
			 * 截至本月脱管
			 */
			culpritStatusTj.setJzbytg(culpritStatusTjMapper.findJzbytg(groupId));
			
			/**
			 * 本月重新犯罪
			 */
			culpritStatusTj.setZfxz(culpritStatusTjMapper.findTotal_crime_again(groupId));
			/**
			 * 项目累计
			 */
			//累计接收
			culpritStatusTj.setTotal_accept(culpritStatusTjMapper.findTotal_accept(groupId));
			//累计解除矫正
			culpritStatusTj.setTotal_relieve(culpritStatusTjMapper.findTotal_relieve(groupId));
			//累计重新犯罪
			culpritStatusTj.setTotal_crime_again(culpritStatusTjMapper.findTotal_crime_again(groupId));
			
			this.insert(culpritStatusTj);//自动插入CulpritStatusTj对象
		}
	}
	
	

}









