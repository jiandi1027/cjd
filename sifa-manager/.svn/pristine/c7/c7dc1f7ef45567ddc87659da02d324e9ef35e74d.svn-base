<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rowell.sifa.mapper.policeCheck.ExceptionInfoMapper">
  <resultMap id="BaseResultMap" type="com.rowell.sifa.pojo.policeCheck.ExceptionInfo">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="EXCEPTION_TYPE" jdbcType="VARCHAR" property="exceptionType" />
    <result column="CULPRIT_ID" jdbcType="VARCHAR" property="culpritId" />
    <result column="DETAILS" jdbcType="VARCHAR" property="details" />
    <result column="OCCURRENCE_TIME" jdbcType="TIMESTAMP" property="occurrenceTime" />
    <result column="OCCURRENCE_PLACE" jdbcType="VARCHAR" property="occurrencePlace" />
  </resultMap>
  <sql id="Base_Column_List">
    ID, EXCEPTION_TYPE, CULPRIT_ID, DETAILS, OCCURRENCE_TIME, OCCURRENCE_PLACE,
    (select g.name from SYS_GROUP g left join SF_CULPRIT c on g.id=c.GROUP_ID where c.id=CULPRIT_ID) groupName,
    (select c.name from SF_CULPRIT c where c.id=CULPRIT_ID) culpritName,
    (select c.identification from SF_CULPRIT c where c.id=CULPRIT_ID) identification,
    (select c.CREATED_TIME from SF_CULPRIT c where c.id=CULPRIT_ID) createdTime
    
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from SF_EXCEPTION_INFO
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from SF_EXCEPTION_INFO
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.rowell.sifa.pojo.policeCheck.ExceptionInfo">
    insert into SF_EXCEPTION_INFO (ID, EXCEPTION_TYPE, CULPRIT_ID, 
      DETAILS, OCCURRENCE_TIME, OCCURRENCE_PLACE
      )
    values (#{id,jdbcType=VARCHAR}, #{exceptionType,jdbcType=VARCHAR}, #{culpritId,jdbcType=VARCHAR}, 
      #{details,jdbcType=VARCHAR}, #{occurrenceTime,jdbcType=TIMESTAMP}, #{occurrencePlace,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.rowell.sifa.pojo.policeCheck.ExceptionInfo">
    insert into SF_EXCEPTION_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="exceptionType != null">
        EXCEPTION_TYPE,
      </if>
      <if test="culpritId != null">
        CULPRIT_ID,
      </if>
      <if test="details != null">
        DETAILS,
      </if>
      <if test="occurrenceTime != null">
        OCCURRENCE_TIME,
      </if>
      <if test="occurrencePlace != null">
        OCCURRENCE_PLACE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="exceptionType != null">
        #{exceptionType,jdbcType=VARCHAR},
      </if>
      <if test="culpritId != null">
        #{culpritId,jdbcType=VARCHAR},
      </if>
      <if test="details != null">
        #{details,jdbcType=VARCHAR},
      </if>
      <if test="occurrenceTime != null">
        #{occurrenceTime,jdbcType=TIMESTAMP},
      </if>
      <if test="occurrencePlace != null">
        #{occurrencePlace,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.rowell.sifa.pojo.policeCheck.ExceptionInfo">
    update SF_EXCEPTION_INFO
    <set>
      <if test="exceptionType != null">
        EXCEPTION_TYPE = #{exceptionType,jdbcType=VARCHAR},
      </if>
      <if test="culpritId != null">
        CULPRIT_ID = #{culpritId,jdbcType=VARCHAR},
      </if>
      <if test="details != null">
        DETAILS = #{details,jdbcType=VARCHAR},
      </if>
      <if test="occurrenceTime != null">
        OCCURRENCE_TIME = #{occurrenceTime,jdbcType=TIMESTAMP},
      </if>
      <if test="occurrencePlace != null">
        OCCURRENCE_PLACE = #{occurrencePlace,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.rowell.sifa.pojo.policeCheck.ExceptionInfo">
    update SF_EXCEPTION_INFO
    set EXCEPTION_TYPE = #{exceptionType,jdbcType=VARCHAR},
      CULPRIT_ID = #{culpritId,jdbcType=VARCHAR},
      DETAILS = #{details,jdbcType=VARCHAR},
      OCCURRENCE_TIME = #{occurrenceTime,jdbcType=TIMESTAMP},
      OCCURRENCE_PLACE = #{occurrencePlace,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectAll" parameterType="com.rowell.sifa.pojo.policeCheck.ExceptionInfo" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from SF_EXCEPTION_INFO t
    <where>
      <include refid="findAllWhere" />
    </where>
    <if test="orderStr!=null">
      <![CDATA[
           order by  ${orderStr}
      ]]>
    </if>
  </select>
  <sql id="findAllWhere">
    <if test="exceptionType != null and exceptionType!=''">
      AND EXCEPTION_TYPE = #{exceptionType,jdbcType=VARCHAR}
    </if>
    <if test="culpritId != null and culpritId!=''">
      AND CULPRIT_ID = #{culpritId,jdbcType=VARCHAR}
    </if>
    <if test="details != null and details!=''">
      AND DETAILS = #{details,jdbcType=VARCHAR}
    </if>
    <if test="occurrenceTime != null">
      AND OCCURRENCE_TIME = #{occurrenceTime,jdbcType=TIMESTAMP}
    </if>
    <if test="occurrencePlace != null and occurrencePlace!=''">
      AND OCCURRENCE_PLACE = #{occurrencePlace,jdbcType=VARCHAR}
    </if>
    <if test="culpritName != null and culpritName!=''">
       AND exists (select * from SF_CULPRIT c where c.id=CULPRIT_ID and c.name like '%'||#{culpritName,jdbcType=VARCHAR}||'%')
      </if>
    <if test="groupId != null and groupId!=''">
      AND  exists ( select g.id from (select * from sys_group  start with id= #{groupId,jdbcType=VARCHAR} connect by prior id = parent_id) g left join SF_CULPRIT c on g.id=c.group_id where c.id=CULPRIT_ID)
    </if> 
  </sql>
</mapper>