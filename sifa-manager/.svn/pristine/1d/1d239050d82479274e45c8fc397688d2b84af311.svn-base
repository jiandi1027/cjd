<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/views/include/taglib.jsp"%>

<form action="${ctx}/monitoring/drift/detail" method="post" id="driftDetailForm">
	
	<div class="easyui-panel" id="p2" title="" style="width: 100%; padding: 5px;margin: 0 auto;">
		<table width="100%" class="grid">
			<tr>
				<th width="10%">矫正对象：</th>
				<td width="40%">${drift.culpritName }</td>
				<th width="10%">反馈人：</th>
				<td width="40%">${drift.createrName }</td>
			</tr>
			<tr>
				<th width="10%">定位号码：</th>
				<td width="40%">${drift.mobilenumber }</td>
				<th width="10%">定位方式：</th>
				<td width="40%">${fns:getSysDicValueByKey('SF_TERMINAL_ACTIVITY', 'location_type', drift.type, '') }</td>
			</tr>
			<tr>
				<th width="10%">定位时间：</th>
				<td width="90%" colspan="3"><fmt:formatDate value="${drift.gpstime}" pattern="yyyy-MM-dd hh:mm:ss" /></td>
			</tr>
			<tr>
				<th width="10%">漂移经度：</th>
				<td width="40%">${drift.oldLon }</td>
				<th width="10%">漂移纬度：</th>
				<td width="40%">${drift.oldLat }</td>
			</tr>
			<tr>
				<th width="10%" rowspan="2">漂移位置：</th>
				<td width="90%" colspan="3">${drift.oldLocation }
			</tr>
			<tr height="200px;">
           		<td id="driftoldmap" colspan="3"></td>
			</tr>
			<tr>
				<th width="10%">实际经度：</th>
				<td width="40%">${drift.newLon }</td>
				<th width="10%">实际纬度：</th>
				<td width="40%">${drift.newLat }</td>
			</tr>
			<tr>
				<th width="10%" rowspan="2">实际位置：</th>
				<td width="90%" colspan="3">${drift.newLocation }</td>
			</tr>
			<tr height="200px;">
           		<td id="driftnewmap" colspan="3"></td>
			</tr>
			<tr>
				<th width="10%">情况说明：</th>
				<td width="90%" colspan="3">
					<textArea id="note" name="note" class="easyui-validatebox" readonly="readonly" style="width: 80%;height:50px;overflow:auto;resize:none;" >${drift.note }</textArea>
				</td>
			</tr>
		</table>
	</div>
</form>
<script type="text/javascript">
var driftoldmap;
var driftnewmap;
var driftoldmarker;
var driftnewmarker;

driftoldmap = new AMap.Map("driftoldmap");
driftoldmap.setZoomAndCenter(9, [ 120.670738, 28.005425 ]);
map.plugin([ "AMap.Geocoder", "AMap.convertFrom" ], function() {
var point1 = new AMap.LngLat('${drift.oldLon }','${drift.oldLat }');
var geocoder = new AMap.Geocoder({
	radius : 1000,
	extensions : "all",
	batch : false
});
new AMap.convertFrom(point1,"gps",function(status, result) {
	geocoder.getAddress(result.locations[0], function(status,resulta) {
			driftoldmarker = new AMap.Marker({
				position : result.locations[0],
				icon : new AMap.Icon({
					image : '${ctxStatic}/style/images/0202.png'
				}),
				offset : new AMap.Pixel(-12,-20)
			});
			driftoldmarker.setLabel({//label默认蓝框白底左上角显示，样式className为：amap-marker-label
				offset : new AMap.Pixel(-18, 25),//修改label相对于maker的位置
				content : "漂移位置"
			});
			
			driftoldmap.panTo(result.locations[0]);
			driftoldmarker.setMap(driftoldmap);
			driftoldmarker.setAnimation('AMAP_ANIMATION_DROP');
			driftoldmap.setFitView();
		});
	});
});
driftoldmap.setFitView();


driftnewmap = new AMap.Map("driftnewmap");
driftnewmap.setZoomAndCenter(9, [ 120.670738, 28.005425 ]);
map.plugin([ "AMap.Geocoder", "AMap.convertFrom" ], function() {
var point1 = new AMap.LngLat('${drift.newLon }','${drift.newLat }');
var geocoder = new AMap.Geocoder({
	radius : 1000,
	extensions : "all",
	batch : false
});
new AMap.convertFrom(point1,"gps",function(status, result) {
	geocoder.getAddress(result.locations[0], function(status,resulta) {
			driftnewmarker = new AMap.Marker({
				position : result.locations[0],
				icon : new AMap.Icon({
					image : '${ctxStatic}/style/images/0202.png'
				}),
				offset : new AMap.Pixel(-12,-20)
			});
			driftnewmarker.setLabel({//label默认蓝框白底左上角显示，样式className为：amap-marker-label
				offset : new AMap.Pixel(-18, 25),//修改label相对于maker的位置
				content : "实际位置"
			});
			
			driftnewmap.panTo(result.locations[0]);
			driftnewmarker.setMap(driftnewmap);
			driftnewmarker.setAnimation('AMAP_ANIMATION_DROP');
			driftnewmap.setFitView();
		});
	});
});
driftnewmap.setFitView();
</script>