<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/views/include/taglib.jsp"%>
<form  action="" method="post" id="moveInUpdateInfo">
	 <div class="easyui-panel" title="基本信息" style="width:100%;padding:5px;">
		<input type="hidden" name="id" value="${moveIn.id }"/>
			<table width="100%" class="grid">
				<tr>
					<th width="10%">姓名：</th>
					<td width="23%" style="border-right-style:none">${moveIn.name }
						</td>
					<td width="10%" style="border-style:none"></td>
					<td width="23%" style="border-style:none"></td>
					<td width="10%" style="border-style:none"></td>
					<td width="23%" style="border-style:none"></td>
				</tr>
				<tr>
					<th width="10%">身份证号：</th>
					<td width="23%">${moveIn.cedentialsNumber }
						</td>
					<th width="10%">性别：</th>
					<td width="23%" >${fns:getSysDicValueByKey('common_table','sex',moveIn.dicSexKey ,'')} </td>
					<th width="10%">民族：</th>
					<td width="23%" >${fns:getSysDicValueByKey('common_table','nation',moveIn.nation ,'')}</td>
				</tr>
				<tr>
					<th>曾用名：</th>
					<td>${moveIn.alias }</td>
					
					<th>出生日期：</th>
					<td><${moveIn.bornDate}
					</td>
					
					<th>文化程度：</th>
					<td>${fns:getSysDicValueByKey('common_table','whcd',moveIn.dicWhcdKey ,'')}
                  	</td>
				</tr>
				<tr>
					<th>婚姻状况：</th>
					<td> ${fns:getSysDicValueByKey('common_table','hyzk',moveIn.dicHyzkKey ,'')}
                  </td>
					<th>职业：</th>
					<td>${moveIn.job }
						</td>
					<th>原政治面貌：</th> 
					<td> ${fns:getSysDicValueByKey('common_table','zzmm',moveIn.oldPoliticStatusId  ,'')}
                  	</td>
				</tr>
				<tr>
					<th>籍贯：</th>
					<td>${moveIn.origin }
						</td>
					<th>户籍所在地：</th>
					<td>${moveIn.regResidence } 
						</td>
					<th>联系方式：</th>
					<td>${moveIn.contactPhone }
						</td>
				</tr>
				<tr>
					<th>原判罪名：</th>
					<td>${moveIn.crimeInfo }
						</td>
					<th>刑期：</th>
					<td>${moveIn.adjudgePeriod}</td>
					<th>刑期执行类别：</th>
					<td> ${fns:getSysDicValueByKey('common_table','entrust_type_id',moveIn.dicPenalTypeKey ,'')}
                  	</td>
				</tr>
				<tr>
					<th>刑期变动：</th>
					<td>${moveIn.adjudgeChange }
						</td>
					<th>刑期开始日期：</th>
					<td><fmt:formatDate value="${moveIn.adjudgeStartTime}"
									pattern="yyyy-MM-dd" />
					</td>
					<th>刑期结束日期：</th>
					<td><fmt:formatDate value="${moveIn.adjudgeEndTime}"
									pattern="yyyy-MM-dd" />
					</td>
				</tr>
				<tr>
					<th>矫正期限：</th>
					<td> ${moveIn.redressPeriod }
									
					<th>矫正开始日期：</th>
					<td><fmt:formatDate value="${moveIn.redressStartDate}"
									pattern="yyyy-MM-dd" />
					</td>
					<th>矫正结束日期：</th>
					<td><fmt:formatDate value="${moveIn.redressEndDate}"
									pattern="yyyy-MM-dd" />
					</td>
				</tr>
			</table>
		</div>
	 <div class="easyui-panel" title="迁入相关信息" style="width:100%;padding:5px;">
	 	<table width="100%" class="grid" >
			<tr>
				<th width="10%">申请时间：</th>
				<td width="23%"><fmt:formatDate value="${moveIn.moveTime}"
									pattern="yyyy-MM-dd" />
				 </td>
				<th width="10%">原司法所：</th>
				<td width="23%">${moveIn.oldGroup }</td>
				<th width="10%">拟迁往司法所：</th>
				<td width="23%">${moveIn.groupId }
                  	</td>
			</tr>
			<tr>
				<th>现居住地：</th>
				<td colspan="6">${moveIn.oldPlace }
					</td>
			</tr>
			<tr>
				<th>拟居住地：</th>
				<td colspan="6">${moveIn.newPlace }
					</td>
			</tr>
			<tr rowspan="4">
				<th>居住地变更原因：</th>
				<td colspan="6">${moveIn.reason }
 						</td>
				</tr>
			
			<tr rowspan="4">
					<th>已上传附件：</th>
				<td style="border-right-style:none">
				<div id="wtdchUploadIng">
				<c:forEach var="sysFile" items="${fileList}">
					<div id="file_${sysFile.id}">
					${sysFile.originName}
					<div class="webuploadDelbtn" onclick="javascript:window.location.href='${ctx}/sys/file/download?id=${sysFile.id}'">下载</div>
					</div>
				</c:forEach>
				</div>
				</td>
			</tr>
			
			<tr rowspan="3">
				<th>司法所意见：</th>
				<td colspan="6"><input class="easyui-textbox" name="opinion" readonly="readonly"  value="${moveIn.opinion }"
 						data-options="multiline:true,width:583" /></td>
				</tr>
				<tr rowspan="3">
				<th>备注：</th>
				<td colspan="6"><input class="easyui-textbox" name="note" readonly="readonly"  value="${moveIn.note }"
 						data-options="multiline:true,width:583" /></td>
				</tr>
		</table>
	 </div>
	</form>
	<div class="easyui-panel" id="p3" title="审批历史" style="width:99%;padding:5px;margin-bottom: 30px;">
            <table width="100%" class="grid" style="text-align: center;">
                <tr>
                  <th style="text-align:center;" width="20%">操作人</th>
                   <th style="text-align:center;" width="20%">操作时间</th>
                   <th style="text-align:center;" width="20%">操作环节</th>
                   <th style="text-align:center;" width="20%">意见</th>
                   <th style="text-align:center;" width="20%">备注</th>
                </tr>
                <c:forEach items="${processDetails}" var="processDetail">
                <tr>
                   <td style="text-align:center;">${processDetail.createrCnName }</td>
                   <td style="text-align:center;"><fmt:formatDate value="${processDetail.created }"
									pattern="yyyy-MM-dd" /></td>
                   <td style="text-align:center;">${processDetail.auditName }</td>
                   <td style="text-align:center;">${processDetail.dicDecideType == '1'?'同意':'退回'}</td>
                   <td style="text-align:center;">${processDetail.opinion}</td>
                </tr>
                </c:forEach>
            </table>
    </div>
		<form id="moveInReportForm" action="" method="post">
			<input type="hidden" name="id" value="${moveIn.id }" />
			<input type="hidden" name="taskId" value="${moveIn.taskId }" />
			<input type="hidden" name="auditType" value="${moveIn.auditType}" />
			<input type="hidden" name="processInstanceId" value="${moveIn.processInstanceId }" />
			<input type="hidden" name="decideType" value="1" />
		<!-- 	<table>
				<tr>
					<td>是否批准:</td>
					<td>
						<input type="radio" name="decideType" checked="checked" value="1"/>批准&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<input type="radio" name="decideType" value="2" />退回					
					</td>
					
				</tr>
						
				<tr>
					<td>审批意见:</td>
					<td><input type="text" name="opinion" multiline="true"
						class="easyui-textbox" required=true 
						data-options="width:220,height:80"
						 value="" /></td>
				</tr>
				<tr>
					<td>短信发送:</td>
					<td></td>
				</tr>
				<tr align="center">
					<td colspan="2"><a href="javascript:void(0)" id="btn1" class="easyui-linkbutton" onclick="apply()">确定</a>
						<a  id="grade_check_btn2" class="easyui-linkbutton">取消</a></td>
				</tr>
			</table> -->
		</form>
<script type="text/javascript">
//设置好需要提交的表单
//修改
$("#notePathUploader").powerWebUpload({ auto: true,fileNumLimit:5,serverPath:'${ctx}/servlet/file/upload',fileType:'.rar,.zip,.doc,.xls,.docx,.xlsx,.pdf'});
$("#talkRecordUploader").powerWebUpload({ auto: true,fileNumLimit:5,serverPath:'${ctx}/servlet/file/upload',fileType:'.rar,.zip,.doc,.xls,.docx,.xlsx,.pdf'});
$("#relateUploader").powerWebUpload({ auto: true,fileNumLimit:5,serverPath:'${ctx}/servlet/file/upload',fileType:'.rar,.zip,.doc,.xls,.docx,.xlsx,.pdf'});
$('#moveInUpdateInfo').form({
	url:'${ctx}/culprit/moveIn/save',
	onSubmit:function(){
		 progressLoad();
		 var isValid = $(this).form('validate');
         if (!isValid) {
             progressClose();
         }
         return isValid;
	},
	success:function(data){
		progressClose();
		data = JSON.parse(data);
		if(data.status==200){
			$.messager.show({
				title:'提示信息!' ,
				msg:data.msg
			});
			
			 parent.$.modalDialog.openner_dataGrid.datagrid('reload');//之所以能在这里调用到parent.$.modalDialog.openner_dataGrid这个对象，是因为user.jsp页面预定义好了
             parent.$.modalDialog.handler.dialog('close');
			
		}else{
			 parent.$.messager.alert('错误', result.msg, 'error');
		}
		
	}
});	
//工作人员上报
$('#moveInReportForm').form({
	url:'${ctx}/culprit/moveIn/submitMoveInAudit',
	onSubmit:function(){
		 progressLoad();
		 var isValid = $(this).form('validate');
         if (!isValid) {
             progressClose();
         }
         return isValid;
	},
	success:function(data){
		progressClose();
		data = JSON.parse(data);
		if(data.status==200){
			$.messager.show({
				title:'提示信息!' ,
				msg:data.msg
			});
			
			 parent.$.modalDialog.openner_dataGrid.datagrid('reload');//之所以能在这里调用到parent.$.modalDialog.openner_dataGrid这个对象，是因为user.jsp页面预定义好了
             parent.$.modalDialog.handler.dialog('close');
			
		}else{
			 parent.$.messager.alert('错误', result.msg, 'error');
		}
		
	}
});	
</script>