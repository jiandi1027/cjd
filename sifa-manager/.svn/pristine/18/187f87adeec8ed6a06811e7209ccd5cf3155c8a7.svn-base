<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/views/include/taglib.jsp"%>
<form id="deathAuditForm" name="deathAuditForm" action="${ctx}/endcorrect/death/submitDeathAudit" method="post">
	<input type="hidden" name="taskId" value="${death.taskId}"/>
	<input type="hidden" name="id" value="${death.id}"/>
	<input type="hidden" name="auditType" value="${death.auditType}"/>
	<TABLE border=0 cellSpacing=0 cellPadding=0 width="100%" bgColor=#c4d8ed>
 	<c:choose>
 		<c:when test="${empty death.culpritId }">
 		
 			<sys:culpritInfo hiddenId="culpritId" hiddenName="culpritId" id="culpritName" name="culpritName" required="true" hiddenValue="" formId="deathAuditForm" isSelect="true"/>
 		</c:when>
 		<c:otherwise>
 	
 			<sys:culpritInfo hiddenId="culpritId" hiddenName="culpritId" id="culpritName" name="culpritName" required="false" hiddenValue="${death.culpritId}" formId="deathAuditForm" isSelect="false"/>
 		</c:otherwise>
 	</c:choose>
 
   <TBODY>
 <div class="easyui-panel" title="死亡登记信息" style="width:98%;padding:5px;">
            <table width="100%" class="grid">
                <tr>
                   <th width="10%">死亡日期:</th>
							<td><input readonly = 'readonly' type="text" class="f1 easyui-textbox" name="deathlTime" id="deathlTime" value="<fmt:formatDate value='${death.deathlTime}' pattern="yyyy-MM-dd HH:mm:ss" />"
									/></td>
                </tr>
                <tr>
                    <th>死亡原因:</th>
							<td ><input readonly = 'readonly'type="text" name="deathReason" value="${death.deathReason }"  
								class="f1 easyui-textbox" multiline="true" style = "width:50%"/></td>
                </tr>
                  <tr>
                    <th>其他情况:</th>
							<td ><input readonly = 'readonly' type="text" name="situation" value="${death.situation }"  
								class="f1 easyui-textbox" multiline="true" style = "width:50%"/></td>
                </tr>
            </table>
    </div>
   </TBODY>
</TABLE>

<TABLE border=0 cellSpacing=0 cellPadding=0 width="100%" bgColor=#c4d8ed>

   <TBODY>
   <c:if test="${death.auditType ne 'sfsSb' }">
    <c:if test="${death.auditType ne 'xgzryprint' }">
<TR>
   			
				<TD height=30 width="15%" align=right >审核结果：</TD>
								<TD  width="35%">
								<input type="radio" name="decideType" value="1" checked="checked"/>同意
								<input type="radio" name="decideType" value="0"/>不同意
								<input type="radio" name="decideType" value="2" />退回
								</TD>
								<TD height=30 width="15%" align=right >审核意见</TD>
								<TD  width="35%">
								<textarea rows="3" cols="30" name="opinion" required=true missingMessage="审核意见不能为空!"></textarea>
								</TD>
				</TR>
				</c:if>
				</c:if>
				 <c:if test="${death.auditType eq 'xgzryprint' }">
<TR>
				<TD height=30 width="15%" align=right >审核结果：</TD>
								<TD  width="35%">
								<input type="radio" name="decideType" value="1" checked="checked"/>结束流程
								</TD>
				</TR>
				</c:if>
   </TBODY>
</TABLE>
	 <c:if test="${death.auditType eq 'sfsSb' }">
	 <input type="hidden" name="decideType" value="1"/>
	 </c:if>
	
</form>
<script type="text/javascript">
function submitForm(){
	 $('#deathAuditForm').form('submit');
}
$(function() {
	$('#deathAuditForm').form({
		url:'${ctx}/endcorrect/death/submitDeathAudit',
		onSubmit:function(){
			 progressLoad();
			 var isValid = $(this).form('validate');
             if (!isValid) {
                 progressClose();
             }
             return isValid;
		},
		success:function(data){
			data = JSON.parse(data);
			if(data.status==200){
				$.messager.show({
					title:'提示信息!' ,
					msg:'上报成功'
				});
				 parent.$.modalDialog.openner_dataGrid.datagrid('reload');//之所以能在这里调用到parent.$.modalDialog.openner_dataGrid这个对象，是因为user.jsp页面预定义好了
                 parent.$.modalDialog.handler.dialog('close');
			}else{
				 parent.$.messager.alert('错误', result.msg, 'error');
			}
			progressClose();
		}
	});	

$('#culpritId').combogrid({    
	delay: 500,
	 panelWidth: 300, 
	 striped:true,
	 panelHeight: 300,
	mode: 'remote',  
	idField: 'id',
	textField: 'name',
	url: '${ctx}/culpritinfo/culprit/list',
	columns: [[
		{field:'name',title:'姓名',width:120,align:'center'},
		{field:'dicSexKey',title:'性别',width:80,align:'center'}
	]],
	fitColumns: true,
	pagination: true,           //是否分页  
rownumbers: true,           //序号  
collapsible: false,         //是否可折叠的  
method: 'post',
onSelect:function(record){
	 var arr = $('#culpritId').combogrid('grid').datagrid('getSelections');
	 $('#deathAuditForm').form('load',arr[0]);
	}
}); 


//取得分页组件对象  
var pager = $('#culpritId').combogrid('grid').datagrid('getPager');  
if (pager) {  
    $(pager).pagination({  
        pageSize: 10,               //每页显示的记录条数，默认为10  
        beforePageText: '第',       //页数文本框前显示的汉字  
        afterPageText: '',
        displayMsg: ''
    });  
}  
});


</script>
